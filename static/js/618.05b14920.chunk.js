(self.webpackChunkjira=self.webpackChunkjira||[]).push([[618],{4618:function(t,n,r){"use strict";r.r(n),r.d(n,{default:function(){return C}});var e,i=r(335),u=r(5151),o=r(3119),s=r(9083),c=r(639),a=r(8356),f=r(4830),d=r(134),l=r(5854),h=r(1276),v=r(866),m=r.n(v),p=r(8890),$=r(4243),y=r(5408),M=r(6097),g=r(9105),Z=r(7324),j=r(1335),D=r(2402),x=r(6186),S=r(9737),k=r(1735),I=function(){return{projectId:(0,s.cf)()}},b=function(){return["epics",I()]},w=r(2075),T=function(t){var n=function(t){var n=(0,a.i)();return(0,c.useMutation)((function(t){return n("epics",{data:t,method:"POST"})}),(0,f.HZ)(t))}(b()),r=n.mutate,e=n.isLoading,d=n.error,h=j.Z.useForm(),v=(0,i.Z)(h,1)[0],m=(0,s.cf)(),p=function(){var n=(0,Z.Z)((0,M.Z)().mark((function n(e){return(0,M.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r((0,g.Z)((0,g.Z)({},e),{},{projectId:m}));case 2:t.onClose();case 3:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}();return(0,u.useEffect)((function(){v.resetFields()}),[v,t.visible]),(0,w.jsx)(D.Z,{visible:t.visible,onClose:t.onClose,forceRender:!0,destroyOnClose:!0,width:"100%",children:(0,w.jsx)(O,{children:e?(0,w.jsx)(x.Z,{size:"large"}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("h1",{children:"\u521b\u5efa\u4efb\u52a1\u7ec4"}),(0,w.jsx)(o.Tv,{error:d}),(0,w.jsxs)(j.Z,{form:v,layout:"vertical",style:{width:"40rem"},onFinish:p,children:[(0,w.jsx)(j.Z.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d"}],children:(0,w.jsx)(S.Z,{placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d\u79f0"})}),(0,w.jsx)(j.Z.Item,{style:{textAlign:"right"},children:(0,w.jsx)(l.Z,{loading:e,type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})]})})})},O=k.Z.div(e||(e=(0,y.Z)(["\n  height: 80vh;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"]))),C=function(){var t=(0,s.BA)().data,n=function(t){var n=(0,a.i)();return(0,c.useQuery)(["=EpicS",t],(function(){return n("epics",{data:t})}))}(I()).data,r=(0,p.Xi)({projectId:null===t||void 0===t?void 0:t.id}).data,e=function(t){var n=(0,a.i)();return(0,c.useMutation)((function(t){var r=t.id;return n("epics/".concat(r),{method:"DELETE"})}),(0,f.kd)(t))}(b()).mutate,v=(0,u.useState)(!1),y=(0,i.Z)(v,2),M=y[0],g=y[1];return(0,w.jsxs)(o.X_,{children:[(0,w.jsxs)(o.X2,{between:!0,children:[(0,w.jsxs)("h1",{children:[null===t||void 0===t?void 0:t.name,"\u4efb\u52a1\u7ec4"]}),(0,w.jsx)(l.Z,{onClick:function(){return g(!0)},type:"link",children:"\u521b\u5efa\u4efb\u52a1\u7ec4"})]}),(0,w.jsx)(h.ZP,{style:{overflow:"scroll"},dataSource:n,itemLayout:"vertical",renderItem:function(n){return(0,w.jsxs)(h.ZP.Item,{children:[(0,w.jsx)(h.ZP.Item.Meta,{title:(0,w.jsxs)(o.X2,{between:!0,children:[(0,w.jsx)("span",{children:n.name}),(0,w.jsx)(l.Z,{onClick:function(){return function(t){d.Z.confirm({title:"\u786e\u5b9a\u5220\u9664\u9879\u76ee\u7ec4\uff1a".concat(t.name),content:"\u70b9\u51fb\u786e\u5b9a\u5220\u9664",okText:"\u786e\u5b9a",onOk:function(){e({id:t.id})}})}(n)},type:"link",children:"\u5220\u9664"})]}),description:(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{children:["\u5f00\u59cb\u65f6\u95f4\uff1a",m()(n.start).format("YYYY-MM-DD")]}),(0,w.jsxs)("div",{children:["\u7ed3\u675f\u65f6\u95f4\uff1a",m()(n.end).format("YYYY-MM-DD")]})]})}),(0,w.jsx)("div",{children:null===r||void 0===r?void 0:r.filter((function(t){return t.epicId===n.id})).map((function(n){return(0,w.jsx)($.rU,{to:"/project/".concat(null===t||void 0===t?void 0:t.id,"/kanban?editingTaskId=").concat(n.id),children:n.name},n.id)}))})]})}}),(0,w.jsx)(T,{onClose:function(){return g(!1)},visible:M})]})}},9083:function(t,n,r){"use strict";r.d(n,{A_:function(){return p},BA:function(){return d},LD:function(){return m},cf:function(){return f},qu:function(){return v},wm:function(){return h},xS:function(){return l}});var e=r(335),i=r(8890),u=r(4898),o=r(5166),s=r(462),c=r(8145),a=r(5151),f=function(){var t,n=null===(t=(0,s.TH)().pathname.match(/project\/(\d+)/))||void 0===t?void 0:t[1];return Number(n)},d=function(){return(0,o.Y$)(f())},l=function(){return{projectId:f()}},h=function(){return[u.sl,l()]},v=function(){var t=(0,c.A)(["name","typeId","processorId","tagId"]),n=(0,e.Z)(t,1)[0],r=f();return(0,a.useMemo)((function(){return{projectId:r,typeId:Number(n.typeId)||void 0,processorId:Number(n.processorId)||void 0,tagId:Number(n.tagId)||void 0,name:n.name}}),[r,n])},m=function(){return[i.AH,v()]},p=function(){var t=(0,c.A)(["editingTaskId"]),n=(0,e.Z)(t,2),r=n[0].editingTaskId,u=n[1],o=(0,i.gK)(Number(r)),s=o.data,f=o.isLoading;return{editingTaskId:r,task:s,startEdit:(0,a.useCallback)((function(t){u({editingTaskId:t})}),[u]),close:(0,a.useCallback)((function(){u({editingTaskId:""})}),[u]),isLoading:f}}},4898:function(t,n,r){"use strict";r.d(n,{C5:function(){return s},gW:function(){return f},js:function(){return a},sl:function(){return o},xn:function(){return c}});var e=r(639),i=r(8356),u=r(4830),o="=KANBANS",s=function(t){var n=(0,i.i)();return(0,e.useQuery)([o,t],(function(){return n("kanbans",{data:t})}))},c=function(t){var n=(0,i.i)();return(0,e.useMutation)((function(t){return n("kanbans",{data:t,method:"POST"})}),(0,u.HZ)(t))},a=function(t){var n=(0,i.i)();return(0,e.useMutation)((function(t){var r=t.id;return n("kanbans/".concat(r),{method:"DELETE"})}),(0,u.kd)(t))},f=function(t){var n=(0,i.i)();return(0,e.useMutation)((function(t){return n("kanbans/reorder",{data:t,method:"POST"})}),(0,u.c1)(t))}},5166:function(t,n,r){"use strict";r.d(n,{Ae:function(){return f},Y$:function(){return d},Z0:function(){return s},_m:function(){return c},sX:function(){return o},yn:function(){return a}});var e=r(8356),i=r(639),u=r(4830),o="PROJECTS",s=function(t){var n=(0,e.i)();return(0,i.useQuery)([o,t],(function(){return n("projects",{data:t})}))},c=function(t){var n=(0,e.i)();return(0,i.useMutation)((function(t){return n("projects/".concat(t.id),{method:"PATCH",data:t})}),(0,u.k1)(t))},a=function(t){var n=(0,e.i)();return(0,i.useMutation)((function(t){return n("projects",{data:t,method:"POST"})}),(0,u.HZ)(t))},f=function(t){var n=(0,e.i)();return(0,i.useMutation)((function(t){var r=t.id;return n("projects/".concat(r),{method:"DELETE"})}),(0,u.kd)(t))},d=function(t){var n=(0,e.i)();return(0,i.useQuery)(["project",{id:t}],(function(){return n("projects/".concat(t))}),{enabled:Boolean(t)})}},8890:function(t,n,r){"use strict";r.d(n,{AH:function(){return c},Az:function(){return v},G1:function(){return l},G8:function(){return f},Xi:function(){return a},fB:function(){return d},gK:function(){return h}});var e=r(9105),i=r(639),u=r(8356),o=r(4830),s=r(1462),c="=TANSKS",a=function(t){var n=(0,u.i)(),r=(0,e.Z)((0,e.Z)({},t),{},{name:(0,s.Nr)(null===t||void 0===t?void 0:t.name,200)});return(0,i.useQuery)([c,r],(function(){return n("tasks",{data:r})}))},f=function(t){var n=(0,u.i)();return(0,i.useMutation)((function(t){return n("tasks",{data:t,method:"POST"})}),(0,o.HZ)(t))},d=function(t){var n=(0,u.i)();return(0,i.useMutation)((function(t){var r=t.id;return n("tasks/".concat(r),{method:"DELETE"})}),(0,o.kd)(t))},l=function(t){var n=(0,u.i)();return(0,i.useMutation)((function(t){return n("projects/".concat(t.id),{method:"PATCH",data:t})}),(0,o.k1)(t))},h=function(t){var n=(0,u.i)();return(0,i.useQuery)(["task",{id:t}],(function(){return n("tasks/".concat(t))}),{enabled:Boolean(t)})},v=function(t){var n=(0,u.i)();return(0,i.useMutation)((function(t){return n("tasks/reorder",{data:t,method:"POST"})}),(0,o.R5)(t))}},8145:function(t,n,r){"use strict";r.d(n,{A:function(){return a},G:function(){return f}});var e=r(7220),i=r(9105),u=r(335),o=r(1462),s=r(5151),c=r(4243),a=function(t){var n=(0,c.lr)(),r=(0,u.Z)(n,1)[0],o=f();return[(0,s.useMemo)((function(){return t.reduce((function(t,n){return(0,i.Z)((0,i.Z)({},t),{},(0,e.Z)({},n,r.get(n)||""))}),{})}),[r]),function(t){o(t)}]},f=function(){var t=(0,c.lr)(),n=(0,u.Z)(t,2),r=n[0],e=n[1];return function(t){var n=(0,o.sW)((0,i.Z)((0,i.Z)({},Object.fromEntries(r)),t));return e(n)}}},4830:function(t,n,r){"use strict";r.d(n,{HZ:function(){return v},kd:function(){return l},k1:function(){return h},c1:function(){return m},R5:function(){return p}});var e=r(2215),i=r(9105),u=r(6097),o=r(7324),s=r(639),c=function(t){var n=t.fromId,r=t.type,i=t.referenceId,u=t.list,o=(0,e.Z)(u),s=o.findIndex((function(t){return t.id===n}));if(!i)return f((0,e.Z)(o),s,o.length-1);var c=o.findIndex((function(t){return t.id===i}));return("after"===r?f:a)((0,e.Z)(o),s,c)},a=function(t,n,r){var e=t[r],i=t.splice(n,1)[0],u=t.indexOf(e);return t.splice(u,0,i),t},f=function(t,n,r){var e=t[r],i=t.splice(n,1)[0],u=t.indexOf(e);return t.splice(u+1,0,i),t},d=function(t,n){var r=(0,s.useQueryClient)();return{onSuccess:function(){return r.invalidateQueries(t)},onMutate:function(e){return(0,o.Z)((0,u.Z)().mark((function i(){var o;return(0,u.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=r.getQueryData(t),r.setQueryData(t,(function(t){return n(e,t)})),i.abrupt("return",{previousItem:o});case 3:case"end":return i.stop()}}),i)})))()},onError:function(n,e,i){r.setQueryData(t,null===i||void 0===i?void 0:i.previousItem)}}},l=function(t){return d(t,(function(t,n){return(null===n||void 0===n?void 0:n.filter((function(n){return n.id!==t.id})))||[]}))},h=function(t){return d(t,(function(t,n){return(null===n||void 0===n?void 0:n.map((function(n){return n.id===t.id?(0,i.Z)((0,i.Z)({},n),t):n})))||[]}))},v=function(t){return d(t,(function(t,n){return n?[].concat((0,e.Z)(n),[t]):[]}))},m=function(t){return d(t,(function(t,n){return c((0,i.Z)({list:n},t))}))},p=function(t){return d(t,(function(t,n){return c((0,i.Z)({list:n},t)).map((function(n){return n.id===t.fromId?(0,i.Z)((0,i.Z)({},n),{},{kanbanId:t.toKanbanId}):n}))}))}},866:function(t){t.exports=function(){"use strict";var t=1e3,n=6e4,r=36e5,e="millisecond",i="second",u="minute",o="hour",s="day",c="week",a="month",f="quarter",d="year",l="date",h="Invalid Date",v=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,p={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var n=["th","st","nd","rd"],r=t%100;return"["+t+(n[(r-20)%10]||n[r]||n[0])+"]"}},$=function(t,n,r){var e=String(t);return!e||e.length>=n?t:""+Array(n+1-e.length).join(r)+t},y={s:$,z:function(t){var n=-t.utcOffset(),r=Math.abs(n),e=Math.floor(r/60),i=r%60;return(n<=0?"+":"-")+$(e,2,"0")+":"+$(i,2,"0")},m:function t(n,r){if(n.date()<r.date())return-t(r,n);var e=12*(r.year()-n.year())+(r.month()-n.month()),i=n.clone().add(e,a),u=r-i<0,o=n.clone().add(e+(u?-1:1),a);return+(-(e+(r-i)/(u?i-o:o-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:a,y:d,w:c,d:s,D:l,h:o,m:u,s:i,ms:e,Q:f}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},M="en",g={};g[M]=p;var Z=function(t){return t instanceof S},j=function t(n,r,e){var i;if(!n)return M;if("string"==typeof n){var u=n.toLowerCase();g[u]&&(i=u),r&&(g[u]=r,i=u);var o=n.split("-");if(!i&&o.length>1)return t(o[0])}else{var s=n.name;g[s]=n,i=s}return!e&&i&&(M=i),i||!e&&M},D=function(t,n){if(Z(t))return t.clone();var r="object"==typeof n?n:{};return r.date=t,r.args=arguments,new S(r)},x=y;x.l=j,x.i=Z,x.w=function(t,n){return D(t,{locale:n.$L,utc:n.$u,x:n.$x,$offset:n.$offset})};var S=function(){function p(t){this.$L=j(t.locale,null,!0),this.parse(t)}var $=p.prototype;return $.parse=function(t){this.$d=function(t){var n=t.date,r=t.utc;if(null===n)return new Date(NaN);if(x.u(n))return new Date;if(n instanceof Date)return new Date(n);if("string"==typeof n&&!/Z$/i.test(n)){var e=n.match(v);if(e){var i=e[2]-1||0,u=(e[7]||"0").substring(0,3);return r?new Date(Date.UTC(e[1],i,e[3]||1,e[4]||0,e[5]||0,e[6]||0,u)):new Date(e[1],i,e[3]||1,e[4]||0,e[5]||0,e[6]||0,u)}}return new Date(n)}(t),this.$x=t.x||{},this.init()},$.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},$.$utils=function(){return x},$.isValid=function(){return!(this.$d.toString()===h)},$.isSame=function(t,n){var r=D(t);return this.startOf(n)<=r&&r<=this.endOf(n)},$.isAfter=function(t,n){return D(t)<this.startOf(n)},$.isBefore=function(t,n){return this.endOf(n)<D(t)},$.$g=function(t,n,r){return x.u(t)?this[n]:this.set(r,t)},$.unix=function(){return Math.floor(this.valueOf()/1e3)},$.valueOf=function(){return this.$d.getTime()},$.startOf=function(t,n){var r=this,e=!!x.u(n)||n,f=x.p(t),h=function(t,n){var i=x.w(r.$u?Date.UTC(r.$y,n,t):new Date(r.$y,n,t),r);return e?i:i.endOf(s)},v=function(t,n){return x.w(r.toDate()[t].apply(r.toDate("s"),(e?[0,0,0,0]:[23,59,59,999]).slice(n)),r)},m=this.$W,p=this.$M,$=this.$D,y="set"+(this.$u?"UTC":"");switch(f){case d:return e?h(1,0):h(31,11);case a:return e?h(1,p):h(0,p+1);case c:var M=this.$locale().weekStart||0,g=(m<M?m+7:m)-M;return h(e?$-g:$+(6-g),p);case s:case l:return v(y+"Hours",0);case o:return v(y+"Minutes",1);case u:return v(y+"Seconds",2);case i:return v(y+"Milliseconds",3);default:return this.clone()}},$.endOf=function(t){return this.startOf(t,!1)},$.$set=function(t,n){var r,c=x.p(t),f="set"+(this.$u?"UTC":""),h=(r={},r[s]=f+"Date",r[l]=f+"Date",r[a]=f+"Month",r[d]=f+"FullYear",r[o]=f+"Hours",r[u]=f+"Minutes",r[i]=f+"Seconds",r[e]=f+"Milliseconds",r)[c],v=c===s?this.$D+(n-this.$W):n;if(c===a||c===d){var m=this.clone().set(l,1);m.$d[h](v),m.init(),this.$d=m.set(l,Math.min(this.$D,m.daysInMonth())).$d}else h&&this.$d[h](v);return this.init(),this},$.set=function(t,n){return this.clone().$set(t,n)},$.get=function(t){return this[x.p(t)]()},$.add=function(e,f){var l,h=this;e=Number(e);var v=x.p(f),m=function(t){var n=D(h);return x.w(n.date(n.date()+Math.round(t*e)),h)};if(v===a)return this.set(a,this.$M+e);if(v===d)return this.set(d,this.$y+e);if(v===s)return m(1);if(v===c)return m(7);var p=(l={},l[u]=n,l[o]=r,l[i]=t,l)[v]||1,$=this.$d.getTime()+e*p;return x.w($,this)},$.subtract=function(t,n){return this.add(-1*t,n)},$.format=function(t){var n=this,r=this.$locale();if(!this.isValid())return r.invalidDate||h;var e=t||"YYYY-MM-DDTHH:mm:ssZ",i=x.z(this),u=this.$H,o=this.$m,s=this.$M,c=r.weekdays,a=r.months,f=function(t,r,i,u){return t&&(t[r]||t(n,e))||i[r].slice(0,u)},d=function(t){return x.s(u%12||12,t,"0")},l=r.meridiem||function(t,n,r){var e=t<12?"AM":"PM";return r?e.toLowerCase():e},v={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:x.s(s+1,2,"0"),MMM:f(r.monthsShort,s,a,3),MMMM:f(a,s),D:this.$D,DD:x.s(this.$D,2,"0"),d:String(this.$W),dd:f(r.weekdaysMin,this.$W,c,2),ddd:f(r.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(u),HH:x.s(u,2,"0"),h:d(1),hh:d(2),a:l(u,o,!0),A:l(u,o,!1),m:String(o),mm:x.s(o,2,"0"),s:String(this.$s),ss:x.s(this.$s,2,"0"),SSS:x.s(this.$ms,3,"0"),Z:i};return e.replace(m,(function(t,n){return n||v[t]||i.replace(":","")}))},$.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},$.diff=function(e,l,h){var v,m=x.p(l),p=D(e),$=(p.utcOffset()-this.utcOffset())*n,y=this-p,M=x.m(this,p);return M=(v={},v[d]=M/12,v[a]=M,v[f]=M/3,v[c]=(y-$)/6048e5,v[s]=(y-$)/864e5,v[o]=y/r,v[u]=y/n,v[i]=y/t,v)[m]||y,h?M:x.a(M)},$.daysInMonth=function(){return this.endOf(a).$D},$.$locale=function(){return g[this.$L]},$.locale=function(t,n){if(!t)return this.$L;var r=this.clone(),e=j(t,n,!0);return e&&(r.$L=e),r},$.clone=function(){return x.w(this.$d,this)},$.toDate=function(){return new Date(this.valueOf())},$.toJSON=function(){return this.isValid()?this.toISOString():null},$.toISOString=function(){return this.$d.toISOString()},$.toString=function(){return this.$d.toUTCString()},p}(),k=S.prototype;return D.prototype=k,[["$ms",e],["$s",i],["$m",u],["$H",o],["$W",s],["$M",a],["$y",d],["$D",l]].forEach((function(t){k[t[1]]=function(n){return this.$g(n,t[0],t[1])}})),D.extend=function(t,n){return t.$i||(t(n,S,D),t.$i=!0),D},D.locale=j,D.isDayjs=Z,D.unix=function(t){return D(1e3*t)},D.en=g[M],D.Ls=g,D.p={},D}()}}]);
//# sourceMappingURL=618.05b14920.chunk.js.map