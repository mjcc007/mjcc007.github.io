"use strict";(self.webpackChunkjira=self.webpackChunkjira||[]).push([[310],{1815:function(n,e,t){t.d(e,{V:function(){return a}});var r=t(9105),u=t(8175),i=t(5686),o=(t(5151),t(2075)),c=["value","onChange","defaultOptName","options"];function a(n){var e=n.value,t=n.onChange,a=n.defaultOptName,d=n.options,f=(0,u.Z)(n,c),s=function(n){return isNaN(Number(n))?0:Number(n)};return(0,o.jsxs)(i.Z,(0,r.Z)((0,r.Z)({value:s(e),onChange:function(n){return null===t||void 0===t?void 0:t(s(n)||void 0)}},f),{},{children:[a?(0,o.jsx)(i.Z.Option,{value:0,children:a}):null,null===d||void 0===d?void 0:d.map((function(n){return(0,o.jsxs)(i.Z.Option,{value:n.id,children:[" ",n.name]},n.id)}))]}))}},7309:function(n,e,t){t.d(e,{o:function(){return f}});var r=t(9105),u=t(335),i=t(5151),o=t(1462),c=t(8356),a=t(1815),d=t(2075),f=function(n){var e=(0,i.useState)([]),t=(0,u.Z)(e,2),f=t[0],s=t[1],l=(0,c.i)();return(0,o.Dl)((function(){l("users").then(s)})),(0,d.jsx)(a.V,(0,r.Z)({options:f||[]},n))}},8310:function(n,e,t){t.r(e),t.d(e,{default:function(){return A}});var r,u=t(335),i=t(5151),o=t(5408),c=t(9105),a=t(1735),d=t(9737),f=t(7309),s=t(2075),l=function(n){var e=n.param,t=n.setParam;return(0,s.jsx)("form",{children:(0,s.jsxs)(v,{children:[(0,s.jsx)(d.Z,{type:"text",value:e.name,onChange:function(n){return t((0,c.Z)((0,c.Z)({},e),{},{name:n.target.value}))}}),(0,s.jsx)(f.o,{value:e.personId,defaultOptName:"\u8d1f\u8d23\u4eba",onChange:function(n){return t((0,c.Z)((0,c.Z)({},e),{},{personId:n}))}})]})})},v=a.Z.div(r||(r=(0,o.Z)(["\n  display: flex;\n  width: 50rem;\n  flex-direction: row;\n"]))),p=t(134),Z=t(3638),j=t(6331),m=t(9216),h=t(3119),k=t(8175),x=t(2343),g=["checked","onCheckedChange"],y=function(n){var e=n.checked,t=n.onCheckedChange,r=(0,k.Z)(n,g);return(0,s.jsx)(x.Z,(0,c.Z)({count:1,value:e?1:0,onChange:function(n){return null===t||void 0===t?void 0:t(!!n)}},r))},C=t(866),I=t.n(C),b=t(462),O=t(5166),D=t(8437),N=function(n){var e=n.list,t=n.users,r=n.loading,u=(n.refresh,(0,b.s0)()),i=(0,O._m)((0,D.nO)()).mutate,o=(0,O.Ae)((0,D.nO)()).mutate,c=(0,D.Dk)().startEdit;return(0,s.jsx)(Z.Z,{loading:r,pagination:!1,columns:[{key:"pin",title:(0,s.jsx)(y,{checked:!0,disabled:!0}),render:function(n,e){return(0,s.jsx)(y,{checked:e.pin,onCheckedChange:(t=e.id,function(n){return i({id:t,pin:n})})});var t}},{key:"name",title:"\u540d\u79f0",dataIndex:"name",sorter:function(n,e){return n.name.localeCompare(e.name)}},{key:"organization",title:"\u90e8\u95e8",dataIndex:"organization"},{key:"personId",title:"\u8d1f\u8d23\u4eba",render:function(n,e){var r;return(0,s.jsx)("span",{children:(null===(r=t.find((function(n){return n.id===e.personId})))||void 0===r?void 0:r.name)||"\u672a\u77e5"})}},{key:"created",title:"\u521b\u5efa\u65f6\u95f4",render:function(n,e){return(0,s.jsx)("span",{children:e.created?I()(e.created).format("YYYY-MM-DD"):"\u65e0"})}},{title:"Action",key:"action",render:function(n,e){return(0,s.jsx)(j.Z,{overlay:(0,s.jsx)(m.Z,{items:[{label:(0,s.jsx)(h.zL,{type:"link",onClick:function(){return function(n){u("/project/".concat(n.id,"/kanban"))}(e)},children:"\u67e5\u770b"}),key:"view"},{label:(0,s.jsx)(h.zL,{type:"link",onClick:function(){return c(e.id)},children:"\u7f16\u8f91"}),key:"edit"},{label:(0,s.jsx)(h.zL,{type:"link",onClick:function(){return n=e.id,void p.Z.confirm({title:"\u786e\u5b9a\u5220\u9664\u8be5\u9879\u76ee\uff1f",content:"\u70b9\u51fb\u786e\u5b9a\u5220\u9664\uff01",okText:"\u786e\u5b9a",onOk:function(){o({id:n})}});var n},children:"\u5220\u9664"}),key:"del"}]}),children:(0,s.jsx)(h.zL,{type:"link",children:"..."})})}}],dataSource:e})},P=t(8356),E=t(5865),L=t(1462),w=["run"];function A(){var n=(0,D.Y1)(),e=(0,u.Z)(n,2),t=e[0],r=e[1],o=(0,O.Z0)((0,L.Nr)(t,200)),c=o.isLoading,a=o.data,d=function(n){var e=(0,P.i)(),t=(0,E.r)(),r=t.run,u=(0,k.Z)(t,w);return(0,i.useEffect)((function(){r(e("users",{data:(0,L.sW)(n||{})}))}),[n]),u}(),f=d.data,v=(0,D.Dk)().open;return(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsxs)(h.X2,{between:!0,children:[(0,s.jsx)("h3",{children:"\u9879\u76ee\u5217\u8868"}),(0,s.jsx)(h.zL,{type:"link",onClick:v,children:"\u521b\u5efa\u9879\u76ee"})]}),(0,s.jsx)(l,{users:f||[],param:t,setParam:r}),(0,s.jsx)(N,{loading:c,list:a||[],users:f||[]})]})}},8437:function(n,e,t){t.d(e,{Dk:function(){return f},Y1:function(){return a},nO:function(){return d}});var r=t(9105),u=t(335),i=t(5166),o=t(5151),c=t(8145),a=function(){var n=(0,c.A)(["name","personId"]),e=(0,u.Z)(n,2),t=e[0],i=e[1];return[(0,o.useMemo)((function(){return(0,r.Z)((0,r.Z)({},t),{},{personId:Number(t.personId)||void 0})}),[t]),i]},d=function(){var n=a(),e=(0,u.Z)(n,1)[0];return[i.sX,e]},f=function(){var n=(0,c.A)(["projectCreate"]),e=(0,u.Z)(n,2),t=e[0].projectCreate,r=e[1],o=(0,c.A)(["editingProjectId"]),a=(0,u.Z)(o,2),d=a[0].editingProjectId,f=a[1],s=(0,i.Y$)(Number(d)),l=s.data,v=s.isLoading,p=(0,c.G)();return{isOpen:"true"===t||Boolean(d),open:function(){return r({projectCreate:!0})},close:function(){return p({projectCreate:"",editingProjectId:""})},startEdit:function(n){return f({editingProjectId:n})},editingProject:l,isLoading:v}}},5166:function(n,e,t){t.d(e,{Ae:function(){return f},Y$:function(){return s},Z0:function(){return c},_m:function(){return a},sX:function(){return o},yn:function(){return d}});var r=t(8356),u=t(639),i=t(4830),o="PROJECTS",c=function(n){var e=(0,r.i)();return(0,u.useQuery)([o,n],(function(){return e("projects",{data:n})}))},a=function(n){var e=(0,r.i)();return(0,u.useMutation)((function(n){return e("projects/".concat(n.id),{method:"PATCH",data:n})}),(0,i.k1)(n))},d=function(n){var e=(0,r.i)();return(0,u.useMutation)((function(n){return e("projects",{data:n,method:"POST"})}),(0,i.HZ)(n))},f=function(n){var e=(0,r.i)();return(0,u.useMutation)((function(n){var t=n.id;return e("projects/".concat(t),{method:"DELETE"})}),(0,i.kd)(n))},s=function(n){var e=(0,r.i)();return(0,u.useQuery)(["project",{id:n}],(function(){return e("projects/".concat(n))}),{enabled:Boolean(n)})}},8145:function(n,e,t){t.d(e,{A:function(){return d},G:function(){return f}});var r=t(7220),u=t(9105),i=t(335),o=t(1462),c=t(5151),a=t(4243),d=function(n){var e=(0,a.lr)(),t=(0,i.Z)(e,1)[0],o=f();return[(0,c.useMemo)((function(){return n.reduce((function(n,e){return(0,u.Z)((0,u.Z)({},n),{},(0,r.Z)({},e,t.get(e)||""))}),{})}),[t]),function(n){o(n)}]},f=function(){var n=(0,a.lr)(),e=(0,i.Z)(n,2),t=e[0],r=e[1];return function(n){var e=(0,o.sW)((0,u.Z)((0,u.Z)({},Object.fromEntries(t)),n));return r(e)}}},4830:function(n,e,t){t.d(e,{HZ:function(){return p},kd:function(){return l},k1:function(){return v},c1:function(){return Z},R5:function(){return j}});var r=t(2215),u=t(9105),i=t(6097),o=t(7324),c=t(639),a=function(n){var e=n.fromId,t=n.type,u=n.referenceId,i=n.list,o=(0,r.Z)(i),c=o.findIndex((function(n){return n.id===e}));if(!u)return f((0,r.Z)(o),c,o.length-1);var a=o.findIndex((function(n){return n.id===u}));return("after"===t?f:d)((0,r.Z)(o),c,a)},d=function(n,e,t){var r=n[t],u=n.splice(e,1)[0],i=n.indexOf(r);return n.splice(i,0,u),n},f=function(n,e,t){var r=n[t],u=n.splice(e,1)[0],i=n.indexOf(r);return n.splice(i+1,0,u),n},s=function(n,e){var t=(0,c.useQueryClient)();return{onSuccess:function(){return t.invalidateQueries(n)},onMutate:function(r){return(0,o.Z)((0,i.Z)().mark((function u(){var o;return(0,i.Z)().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return o=t.getQueryData(n),t.setQueryData(n,(function(n){return e(r,n)})),u.abrupt("return",{previousItem:o});case 3:case"end":return u.stop()}}),u)})))()},onError:function(e,r,u){t.setQueryData(n,null===u||void 0===u?void 0:u.previousItem)}}},l=function(n){return s(n,(function(n,e){return(null===e||void 0===e?void 0:e.filter((function(e){return e.id!==n.id})))||[]}))},v=function(n){return s(n,(function(n,e){return(null===e||void 0===e?void 0:e.map((function(e){return e.id===n.id?(0,u.Z)((0,u.Z)({},e),n):e})))||[]}))},p=function(n){return s(n,(function(n,e){return e?[].concat((0,r.Z)(e),[n]):[]}))},Z=function(n){return s(n,(function(n,e){return a((0,u.Z)({list:e},n))}))},j=function(n){return s(n,(function(n,e){return a((0,u.Z)({list:e},n)).map((function(e){return e.id===n.fromId?(0,u.Z)((0,u.Z)({},e),{},{kanbanId:n.toKanbanId}):e}))}))}}}]);
//# sourceMappingURL=310.f2b8761e.chunk.js.map