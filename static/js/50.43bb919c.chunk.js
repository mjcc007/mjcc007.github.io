"use strict";(self.webpackChunkjira=self.webpackChunkjira||[]).push([[50],{1815:function(n,r,e){e.d(r,{V:function(){return c}});var t=e(9105),i=e(8175),u=e(5686),o=(e(5151),e(2075)),a=["value","onChange","defaultOptName","options"];function c(n){var r=n.value,e=n.onChange,c=n.defaultOptName,d=n.options,s=(0,i.Z)(n,a),f=function(n){return isNaN(Number(n))?0:Number(n)};return(0,o.jsxs)(u.Z,(0,t.Z)((0,t.Z)({value:f(r),onChange:function(n){return null===e||void 0===e?void 0:e(f(n)||void 0)}},s),{},{children:[c?(0,o.jsx)(u.Z.Option,{value:0,children:c}):null,null===d||void 0===d?void 0:d.map((function(n){return(0,o.jsxs)(u.Z.Option,{value:n.id,children:[" ",n.name]},n.id)}))]}))}},7309:function(n,r,e){e.d(r,{o:function(){return s}});var t=e(9105),i=e(335),u=e(5151),o=e(1462),a=e(8356),c=e(1815),d=e(2075),s=function(n){var r=(0,u.useState)([]),e=(0,i.Z)(r,2),s=e[0],f=e[1],l=(0,a.i)();return(0,o.Dl)((function(){l("users").then(f)})),(0,d.jsx)(c.V,(0,t.Z)({options:s||[]},n))}},9050:function(n,r,e){e.r(r),e.d(r,{ColumnsContainer:function(){return tn},default:function(){return rn},useDragEnd:function(){return en}});var t=e(5408),i=e(1735),u=e(6186),o=e(9105),a=e(8175),c=e(5151),d=e(8788),s=e(2075),f=["children"],l=["children"],v=["children"],p=function(n){var r=n.children,e=(0,a.Z)(n,f);return(0,s.jsx)(d.bK,(0,o.Z)((0,o.Z)({},e),{},{children:function(n){return c.isValidElement(r)?c.cloneElement(r,(0,o.Z)((0,o.Z)({},n.droppableProps),{},{ref:n.innerRef,provided:n})):(0,s.jsx)("div",{})}}))},m=c.forwardRef((function(n,r){var e,t=n.children,i=(0,a.Z)(n,l);return(0,s.jsxs)("div",(0,o.Z)((0,o.Z)({ref:r},i),{},{children:[t,null===(e=i.provided)||void 0===e?void 0:e.placeholder]}))})),x=function(n){var r=n.children,e=(0,a.Z)(n,v);return(0,s.jsx)(d._l,(0,o.Z)((0,o.Z)({},e),{},{children:function(n){return c.isValidElement(r)?c.cloneElement(r,(0,o.Z)((0,o.Z)((0,o.Z)({},n.draggableProps),n.dragHandleProps),{},{ref:n.innerRef})):(0,s.jsx)("div",{})}}))},Z=e(3119),h=e(4898),j=e(8890),k=e(6097),g=e(7324),b=e(335),I=e(9737),y=e(639),C=e(8356),T=function(){var n=(0,C.i)();return(0,y.useQuery)(["tasktype"],(function(){return n("taskTypes")}))},w=e(9083);var A=e.p+"static/media/task.1614c33af71e0361d45add352937d5c5.svg";var E,O,N,S=e.p+"static/media/bug.9b8093065b6b0237b8c6df3459fff89b.svg",L=e(4515),D=e(134),M=e(5854),P=function(n){var r=n.kanbanId,e=(0,c.useState)(""),t=(0,b.Z)(e,2),i=t[0],u=t[1],o=(0,j.G8)((0,w.LD)()).mutateAsync,a=(0,w.cf)(),d=(0,c.useState)(!1),f=(0,b.Z)(d,2),l=f[0],v=f[1],p=function(){var n=(0,g.Z)((0,k.Z)().mark((function n(){return(0,k.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o({projectId:a,name:i,kanbanId:r});case 2:v(!1),u("");case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),m=function(){return v((function(n){return!n}))};return(0,c.useEffect)((function(){l||u("")}),[l]),l?(0,s.jsx)(L.Z,{children:(0,s.jsx)(I.Z,{onBlur:m,placeholder:"\u9700\u8981\u505a\u4ec0\u4e48\uff1f",autoFocus:!0,onPressEnter:p,value:i,onChange:function(n){return u(n.target.value)}})}):(0,s.jsx)("div",{onClick:m,children:"+\u521b\u5efa\u4e8b\u52a1"})},H=function(n){var r=n.name,e=n.keyword;if(!e)return(0,s.jsx)(s.Fragment,{children:r});var t=r.split(e);return(0,s.jsx)(s.Fragment,{children:t.map((function(n,r){return(0,s.jsxs)("span",{children:[n,r===t.length-1?null:(0,s.jsx)("span",{style:{color:"#257AFD"},children:e})]},r)}))})},Q=e(672),B=["kanban"],R=function(n){var r,e=n.id,t=T().data,i=null===t||void 0===t||null===(r=t.find((function(n){return n.id===e})))||void 0===r?void 0:r.name;return i?(0,s.jsx)("img",{alt:"task-icon",src:"task"===i?A:S}):null},K=function(n){var r=n.task,e=(0,w.A_)().startEdit,t=(0,w.qu)().name;return(0,s.jsxs)(L.Z,{style:{marginBottom:"0.5rem",cursor:"pointer"},onClick:function(){return e(r.id)},children:[(0,s.jsx)("p",{children:(0,s.jsx)(H,{name:r.name,keyword:t})}),(0,s.jsx)(R,{id:r.typeId})]},r.id)},V=c.forwardRef((function(n,r){var e=n.kanban,t=(0,a.Z)(n,B),i=(0,j.Xi)((0,w.qu)()).data,u=null===i||void 0===i?void 0:i.filter((function(n){return n.kanbanId===e.id})),c=(0,h.js)((0,w.wm)()).mutateAsync;return(0,s.jsxs)(X,(0,o.Z)((0,o.Z)({ref:r},t),{},{children:[(0,s.jsxs)(Z.X2,{between:!0,children:[(0,s.jsx)("h3",{children:e.name}),(0,s.jsx)(M.Z,{type:"primary",shape:"circle",icon:(0,s.jsx)(Q.Z,{}),danger:!0,onClick:function(){D.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u770b\u677f\u5417",onOk:function(){return c({id:e.id})}})}})]}),(0,s.jsxs)(q,{children:[(0,s.jsx)(p,{type:"ROW",direction:"vertical",droppableId:String(e.id),children:(0,s.jsx)(m,{style:{minHeight:"5px"},children:null===u||void 0===u?void 0:u.map((function(n,r){return(0,s.jsx)(x,{index:r,draggableId:"task"+n.id,children:(0,s.jsx)("div",{children:(0,s.jsx)(K,{task:n},n.id)})},n.id)}))})}),(0,s.jsx)(P,{kanbanId:e.id})]})]}))})),X=i.Z.div(E||(E=(0,t.Z)(["\n  min-width: 27rem;\n  border-radius: 6px;\n  background-color: rgb(245, 244, 247);\n  display: flex;\n  flex-direction: column;\n  padding: 0.7rem 0.7rem 1rem;\n  margin-right: 1.5rem;\n"]))),q=i.Z.div(O||(O=(0,t.Z)(["\n  overflow: scroll;\n  flex: 1;\n\n  ::-webkit-scrollbar {\n    display: none;\n  }\n"]))),z=function(){var n=(0,c.useState)(""),r=(0,b.Z)(n,2),e=r[0],t=r[1],i=(0,w.cf)(),u=(0,h.xn)((0,w.wm)()).mutateAsync,o=function(){var n=(0,g.Z)((0,k.Z)().mark((function n(){return(0,k.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u({name:e,projectId:i});case 2:t("");case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,s.jsx)(X,{children:(0,s.jsx)(I.Z,{size:"large",placeholder:"\u65b0\u5efa\u770b\u677f\u540d\u79f0",onPressEnter:o,value:e,onChange:function(n){return t(n.target.value)}})})},F=e(1815),G=function(n){var r=T().data;return(0,s.jsx)(F.V,(0,o.Z)({options:r||[]},n))},_=e(7309),W=e(8145),U=function(){var n=(0,w.qu)(),r=(0,W.G)();return(0,s.jsxs)(Z.X2,{marginBottom:4,gap:!0,children:[(0,s.jsx)(I.Z,{style:{width:"20rem"},placeholder:"\u4efb\u52a1\u540d",value:n.name,onChange:function(n){return r({name:n.target.value})}}),(0,s.jsx)(_.o,{defaultOptName:"\u7ecf\u529e\u4eba",value:n.processorId,onChange:function(n){return r({processorId:n})}}),(0,s.jsx)(G,{defaultOptName:"\u7c7b\u578b",value:n.typeId,onChange:function(n){return r({typeId:n})}}),(0,s.jsx)(M.Z,{onClick:function(){r({typeId:void 0,processorId:void 0,tagId:void 0,name:void 0})},children:"\u91cd\u7f6e"})]})},Y=e(1335),$=e(2858),J={labelCol:{span:8},wrapperCol:{span:16}},nn=function(){var n=(0,$.Z)(),r=(0,b.Z)(n,1)[0],e=(0,w.A_)(),t=e.editingTaskId,i=e.task,u=e.close,a=e.isLoading,d=(0,j.G1)((0,w.LD)()).mutateAsync,f=(0,j.fB)((0,w.LD)()).mutate,l=function(){var n=(0,g.Z)((0,k.Z)().mark((function n(){return(0,k.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d((0,o.Z)((0,o.Z)({},i),r.getFieldsValue()));case 2:u();case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();(0,c.useEffect)((function(){r.setFieldsValue(i)}),[r,i]);return(0,s.jsxs)(D.Z,{okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",forceRender:!0,confirmLoading:a,title:"\u7f16\u8f91\u4efb\u52a1",open:!!t,onCancel:function(){u(),r.resetFields()},onOk:l,children:[(0,s.jsxs)(Y.Z,(0,o.Z)((0,o.Z)({},J),{},{initialValues:i,form:r,children:[(0,s.jsx)(Y.Z.Item,{label:"\u4efb\u52a1\u540d",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1"}],children:(0,s.jsx)(I.Z,{})}),(0,s.jsx)(Y.Z.Item,{label:"\u7ecf\u529e\u4eba",name:"processorId",children:(0,s.jsx)(_.o,{})}),(0,s.jsx)(Y.Z.Item,{label:"\u7c7b\u578b",name:"typeId",children:(0,s.jsx)(G,{})})]})),(0,s.jsx)("div",{style:{textAlign:"right"},children:(0,s.jsx)(M.Z,{type:"primary",shape:"circle",style:{fontSize:"14px"},size:"small",icon:(0,s.jsx)(Q.Z,{}),danger:!0,onClick:function(){u(),D.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u4efb\u52a1\u5417",onOk:function(){return f({id:Number(t)})}})}})})]})};function rn(){var n=(0,w.BA)().data,r=(0,h.C5)((0,w.xS)()),e=r.data,t=r.isLoading,i=(0,j.Xi)((0,w.qu)()).isLoading||t,o=en();return(0,s.jsx)(d.Z5,{onDragEnd:o,children:(0,s.jsxs)(Z.X_,{children:[(0,s.jsxs)("h3",{children:[null===n||void 0===n?void 0:n.name," \u770b\u677f"]}),(0,s.jsx)(U,{}),i?(0,s.jsx)(u.Z,{size:"large"}):(0,s.jsxs)(tn,{children:[(0,s.jsx)(p,{type:"COLUMN",direction:"horizontal",droppableId:"kanban",children:(0,s.jsx)(m,{style:{display:"flex"},children:null===e||void 0===e?void 0:e.map((function(n,r){return(0,s.jsx)(x,{draggableId:"kanban"+n.id,index:r,children:(0,s.jsx)(V,{kanban:n},n.id)},n.id)}))})}),(0,s.jsx)(z,{})]}),(0,s.jsx)(nn,{})]})})}var en=function(){var n=(0,h.C5)((0,w.xS)()).data,r=(0,h.gW)((0,w.wm)()).mutate,e=(0,j.Az)((0,w.LD)()).mutate,t=(0,j.Xi)((0,w.qu)()).data,i=void 0===t?[]:t;return(0,c.useCallback)((function(t){var u=t.source,o=t.destination,a=t.type;if(o)if("COLUMN"===a){var c=null===n||void 0===n?void 0:n[u.index].id,d=null===n||void 0===n?void 0:n[o.index].id;if(!c||!d||c===d)return;var s=o.index>u.index?"after":"before";r({fromId:c,referenceId:d,type:s})}else{var f=+u.droppableId,l=+o.droppableId,v=i.filter((function(n){return n.kanbanId===f}))[u.index],p=i.filter((function(n){return n.kanbanId===l}))[o.index];if((null===v||void 0===v?void 0:v.id)===(null===p||void 0===p?void 0:p.id))return;e({fromId:null===v||void 0===v?void 0:v.id,referenceId:null===p||void 0===p?void 0:p.id,fromKanbanId:f,toKanbanId:l,type:f===l&&o.index>u.index?"after":"before"})}}),[n,r,i,e])},tn=i.Z.div(N||(N=(0,t.Z)(["\n  display: flex;\n  overflow-x: scroll;\n  margin-right: 2rem;\n  flex: 1;\n"])))},9083:function(n,r,e){e.d(r,{A_:function(){return x},BA:function(){return f},LD:function(){return m},cf:function(){return s},qu:function(){return p},wm:function(){return v},xS:function(){return l}});var t=e(335),i=e(8890),u=e(4898),o=e(5166),a=e(462),c=e(8145),d=e(5151),s=function(){var n,r=null===(n=(0,a.TH)().pathname.match(/project\/(\d+)/))||void 0===n?void 0:n[1];return Number(r)},f=function(){return(0,o.Y$)(s())},l=function(){return{projectId:s()}},v=function(){return[u.sl,l()]},p=function(){var n=(0,c.A)(["name","typeId","processorId","tagId"]),r=(0,t.Z)(n,1)[0],e=s();return(0,d.useMemo)((function(){return{projectId:e,typeId:Number(r.typeId)||void 0,processorId:Number(r.processorId)||void 0,tagId:Number(r.tagId)||void 0,name:r.name}}),[e,r])},m=function(){return[i.AH,p()]},x=function(){var n=(0,c.A)(["editingTaskId"]),r=(0,t.Z)(n,2),e=r[0].editingTaskId,u=r[1],o=(0,i.gK)(Number(e)),a=o.data,s=o.isLoading;return{editingTaskId:e,task:a,startEdit:(0,d.useCallback)((function(n){u({editingTaskId:n})}),[u]),close:(0,d.useCallback)((function(){u({editingTaskId:""})}),[u]),isLoading:s}}},4898:function(n,r,e){e.d(r,{C5:function(){return a},gW:function(){return s},js:function(){return d},sl:function(){return o},xn:function(){return c}});var t=e(639),i=e(8356),u=e(4830),o="=KANBANS",a=function(n){var r=(0,i.i)();return(0,t.useQuery)([o,n],(function(){return r("kanbans",{data:n})}))},c=function(n){var r=(0,i.i)();return(0,t.useMutation)((function(n){return r("kanbans",{data:n,method:"POST"})}),(0,u.HZ)(n))},d=function(n){var r=(0,i.i)();return(0,t.useMutation)((function(n){var e=n.id;return r("kanbans/".concat(e),{method:"DELETE"})}),(0,u.kd)(n))},s=function(n){var r=(0,i.i)();return(0,t.useMutation)((function(n){return r("kanbans/reorder",{data:n,method:"POST"})}),(0,u.c1)(n))}},5166:function(n,r,e){e.d(r,{Ae:function(){return s},Y$:function(){return f},Z0:function(){return a},_m:function(){return c},sX:function(){return o},yn:function(){return d}});var t=e(8356),i=e(639),u=e(4830),o="PROJECTS",a=function(n){var r=(0,t.i)();return(0,i.useQuery)([o,n],(function(){return r("projects",{data:n})}))},c=function(n){var r=(0,t.i)();return(0,i.useMutation)((function(n){return r("projects/".concat(n.id),{method:"PATCH",data:n})}),(0,u.k1)(n))},d=function(n){var r=(0,t.i)();return(0,i.useMutation)((function(n){return r("projects",{data:n,method:"POST"})}),(0,u.HZ)(n))},s=function(n){var r=(0,t.i)();return(0,i.useMutation)((function(n){var e=n.id;return r("projects/".concat(e),{method:"DELETE"})}),(0,u.kd)(n))},f=function(n){var r=(0,t.i)();return(0,i.useQuery)(["project",{id:n}],(function(){return r("projects/".concat(n))}),{enabled:Boolean(n)})}},8890:function(n,r,e){e.d(r,{AH:function(){return c},Az:function(){return p},G1:function(){return l},G8:function(){return s},Xi:function(){return d},fB:function(){return f},gK:function(){return v}});var t=e(9105),i=e(639),u=e(8356),o=e(4830),a=e(1462),c="=TANSKS",d=function(n){var r=(0,u.i)(),e=(0,t.Z)((0,t.Z)({},n),{},{name:(0,a.Nr)(null===n||void 0===n?void 0:n.name,200)});return(0,i.useQuery)([c,e],(function(){return r("tasks",{data:e})}))},s=function(n){var r=(0,u.i)();return(0,i.useMutation)((function(n){return r("tasks",{data:n,method:"POST"})}),(0,o.HZ)(n))},f=function(n){var r=(0,u.i)();return(0,i.useMutation)((function(n){var e=n.id;return r("tasks/".concat(e),{method:"DELETE"})}),(0,o.kd)(n))},l=function(n){var r=(0,u.i)();return(0,i.useMutation)((function(n){return r("projects/".concat(n.id),{method:"PATCH",data:n})}),(0,o.k1)(n))},v=function(n){var r=(0,u.i)();return(0,i.useQuery)(["task",{id:n}],(function(){return r("tasks/".concat(n))}),{enabled:Boolean(n)})},p=function(n){var r=(0,u.i)();return(0,i.useMutation)((function(n){return r("tasks/reorder",{data:n,method:"POST"})}),(0,o.R5)(n))}},8145:function(n,r,e){e.d(r,{A:function(){return d},G:function(){return s}});var t=e(7220),i=e(9105),u=e(335),o=e(1462),a=e(5151),c=e(4243),d=function(n){var r=(0,c.lr)(),e=(0,u.Z)(r,1)[0],o=s();return[(0,a.useMemo)((function(){return n.reduce((function(n,r){return(0,i.Z)((0,i.Z)({},n),{},(0,t.Z)({},r,e.get(r)||""))}),{})}),[e]),function(n){o(n)}]},s=function(){var n=(0,c.lr)(),r=(0,u.Z)(n,2),e=r[0],t=r[1];return function(n){var r=(0,o.sW)((0,i.Z)((0,i.Z)({},Object.fromEntries(e)),n));return t(r)}}},4830:function(n,r,e){e.d(r,{HZ:function(){return p},kd:function(){return l},k1:function(){return v},c1:function(){return m},R5:function(){return x}});var t=e(2215),i=e(9105),u=e(6097),o=e(7324),a=e(639),c=function(n){var r=n.fromId,e=n.type,i=n.referenceId,u=n.list,o=(0,t.Z)(u),a=o.findIndex((function(n){return n.id===r}));if(!i)return s((0,t.Z)(o),a,o.length-1);var c=o.findIndex((function(n){return n.id===i}));return("after"===e?s:d)((0,t.Z)(o),a,c)},d=function(n,r,e){var t=n[e],i=n.splice(r,1)[0],u=n.indexOf(t);return n.splice(u,0,i),n},s=function(n,r,e){var t=n[e],i=n.splice(r,1)[0],u=n.indexOf(t);return n.splice(u+1,0,i),n},f=function(n,r){var e=(0,a.useQueryClient)();return{onSuccess:function(){return e.invalidateQueries(n)},onMutate:function(t){return(0,o.Z)((0,u.Z)().mark((function i(){var o;return(0,u.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=e.getQueryData(n),e.setQueryData(n,(function(n){return r(t,n)})),i.abrupt("return",{previousItem:o});case 3:case"end":return i.stop()}}),i)})))()},onError:function(r,t,i){e.setQueryData(n,null===i||void 0===i?void 0:i.previousItem)}}},l=function(n){return f(n,(function(n,r){return(null===r||void 0===r?void 0:r.filter((function(r){return r.id!==n.id})))||[]}))},v=function(n){return f(n,(function(n,r){return(null===r||void 0===r?void 0:r.map((function(r){return r.id===n.id?(0,i.Z)((0,i.Z)({},r),n):r})))||[]}))},p=function(n){return f(n,(function(n,r){return r?[].concat((0,t.Z)(r),[n]):[]}))},m=function(n){return f(n,(function(n,r){return c((0,i.Z)({list:r},n))}))},x=function(n){return f(n,(function(n,r){return c((0,i.Z)({list:r},n)).map((function(r){return r.id===n.fromId?(0,i.Z)((0,i.Z)({},r),{},{kanbanId:n.toKanbanId}):r}))}))}}}]);
//# sourceMappingURL=50.43bb919c.chunk.js.map